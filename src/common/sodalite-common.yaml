# Meta
ref: sodalite/stable/${basearch}/common
include: [
  #"packages/fedora-ostree-pkgs.yaml", # BUG: Circular dependency caused in packages/elementary-pkgs.yaml, so we'll need to comment this out for now
  "packages/elementary-pkgs.yaml"
]

# Version
releasever: "35" # Fedora version
automatic-version-prefix: "${releasever}-22.1" # <base>-<year>.<release> (SEE: https://github.com/sodaliterocks/sodalite/releases/tag/v/stable/35-22.0)
automatic-version-suffix: "."

# Repositories
repos:
  - copr_decathorpe_elementary-staging
  - copr_stsdc_monitor
  - fedora
  - fedora-updates

# Packages
packages:
  # Base
  - fedora-release
  - fedora-release-ostree-desktop
  - fedora-repos-archive
  - fedora-repos-ostree
  # Container management
  - buildah
  - podman
  - skopeo
  - toolbox
  # Dev
  - elfutils-libelf-devel
  - git-core
  - git-lfs
  - glibc-devel
  - kernel-devel
  - meson
  # Device enhancements
  - hfsplus-tools # HFS filesystem tools for Apple hardware
  - smartmontools # tlp recommends installing
  - tlp # Enhancements for laptop batteries
  # Fonts
  - google-roboto-mono-fonts # Roboto Mono
  - opendyslexic-fonts # Open Dyslexic
  - rsms-inter-fonts # Inter
  # GVfs
  - gvfs
  - gvfs-afc
  - gvfs-afp
  - gvfs-fuse
  - gvfs-gphoto2
  - gvfs-mtp
  - gvfs-nfs
  - gvfs-smb
  # Package management
  - flatpak
  - gnome-software # Replacement for AppCenter
  - python-pip
  - rpm-ostree
  # Misc
  - com.github.stsdc.monitor
  - lvm2
  - xdg-desktop-portal
  - xprop
packages-x86_64:
  - efibootmgr
  - grub2-efi-ia32
  - grub2-efi-x64
  - grub2-pc
  - hyperv-daemons
  - mcelog
  - microcode_ctl
  - open-vm-tools-desktop
  - ostree-grub2
  - shim-ia32
  - shim-x64
  - thermald
  - virtualbox-guest-additions
  - xorg-x11-drv-intel
  - xorg-x11-drv-openchrome
  - xorg-x11-drv-vesa
  - xorg-x11-drv-vmware
exclude-packages:
  - PackageKit
  - gnome-tour # GNOME is impossible to reach, so we don't need this
  - xdg-desktop-portal-gnome

# File manipulation
add-files: [
  # HACK: Removing files by overwriting them (see https://github.com/electricduck/sodalite/issues/9#issuecomment-1010384738)
  ["../sysroot/etc/xdg/autostart/org.gnome.Evolution-alarm-notify.desktop", "/etc/xdg/autostart/org.gnome.Evolution-alarm-notify.desktop"],
  ["../sysroot/etc/xdg/autostart/plank.desktop", "/etc/xdg/autostart/plank.desktop"],
  ["../sysroot/usr/lib64/switchboard/personal/liblocale-plug.so", "/usr/lib64/switchboard/personal/liblocale-plug.so"],
  ["../sysroot/usr/lib64/switchboard/personal/libsecurity-privacy.so", "/usr/lib64/switchboard/personal/libsecurity-privacy.so"],
  ["../sysroot/usr/lib64/switchboard/system/libdatetime.so", "/usr/lib64/switchboard/system/libdatetime.so"],
  ["../sysroot/usr/lib64/switchboard/system/libparental-controls.so", "/usr/lib64/switchboard/system/libparental-controls.so"],
  ["../sysroot/usr/share/wayland-sessions/gnome.desktop", "/usr/share/wayland-sessions/gnome.desktop"],
  ["../sysroot/usr/share/wayland-sessions/gnome-wayland.desktop", "/usr/share/wayland-sessions/gnome-wayland.desktop"],
  ["../sysroot/usr/share/xsessions/gnome.desktop", "/usr/share/xsessions/gnome.desktop"],
  ["../sysroot/usr/share/xsessions/gnome-xorg.desktop", "/usr/share/xsessions/gnome-xorg.desktop"],

  # Tools (/usr/bin/sodalite-*)
  ["../../lib/sodaliterocks.common/bash/common.sh", "/usr/libexec/sodalite/bash/common.sh"],
  ["../tools/cleanup.sh", "/usr/bin/sodalite-cleanup"],
  ["../tools/plank-wrapper.sh", "/usr/bin/sodalite-plank-wrapper"],

  # /etc
  ["../../lib/elementary.default-settings/appcenter/appcenter.hiddenapps", "/etc/appcenter/appcenter.hiddenapps"],
  ["../../lib/elementary.default-settings/cups/default-testpage.pdf", "/etc/cups/default-testpage.pdf"],
  ["../../lib/elementary.default-settings/gtk/settings.ini", "/etc/gtk/settings.ini"],
  ["../sysroot/etc/issue", "/etc/issue"],
  ["../sysroot/etc/sodalite-variant", "/etc/sodalite-variant"],
  ["../sysroot/etc/tlp.d/50-vm-writeback.conf", "/etc/tlp.d/50-vm-writeback.conf"],
  ["../sysroot/etc/upstream-release/lsb-release", "/etc/upstream-release/lsb-release"],

  # /etc/skel
  ["../../lib/elementary.default-settings/skel/flatpak/repo/appcenter.trustedkeys.gpg", "/usr/share/gnupg/appcenter.gpg"],
  ["../../lib/elementary.default-settings/skel/plank/dock1/launchers/gala-multitaskingview.dockitem", "/etc/skel/.config/plank/dock1/launchers/gala-multitaskingview.dockitem"],
  ["../../lib/elementary.default-settings/skel/plank/dock1/launchers/io.elementary.calendar.dockitem", "/etc/skel/.config/plank/dock1/launchers/io.elementary.calendar.dockitem"],
  ["../../lib/elementary.default-settings/skel/plank/dock1/launchers/io.elementary.music.dockitem", "/etc/skel/.config/plank/dock1/launchers/io.elementary.music.dockitem"],
  ["../../lib/elementary.default-settings/skel/plank/dock1/launchers/io.elementary.photos.dockitem", "/etc/skel/.config/plank/dock1/launchers/io.elementary.photos.dockitem"],
  ["../../lib/elementary.default-settings/skel/.inputrc", "/etc/skel/.inputrc"],
  ["../../lib/elementary.default-settings/sudoers.d/pwfeedback", "/etc/sudoers.d/pwfeedback"],
  ["../sysroot/etc/skel/dot.bashrc", "/etc/skel/.bashrc"],
  ["../sysroot/etc/skel/dot.config/plank/dock1/launchers/firefox.dockitem", "/etc/skel/.config/plank/dock1/launchers/firefox.dockitem"],
  ["../sysroot/etc/skel/dot.config/plank/dock1/launchers/io.elementary.files.dockitem", "/etc/skel/.config/plank/dock1/launchers/io.elementary.files.dockitem"],
  ["../sysroot/etc/skel/dot.config/plank/dock1/launchers/org.gnome.Software.dockitem", "/etc/skel/.config/plank/dock1/launchers/org.gnome.Software.dockitem"],

  # /etc/systemd
  ["../sysroot/etc/systemd/system/generate-oemconf.service", "/etc/systemd/system/generate-oemconf.service"],
  ["../sysroot/etc/systemd/system/sodalite-install-appcenter-flatpak.service", "/etc/systemd/system/sodalite-install-appcenter-flatpak.service"],

  # /etc/xdg
  ["../sysroot/etc/xdg/autostart/gnome-software-service.desktop", "/etc/xdg/autostart/gnome-software-service.desktop"],
  ["../sysroot/etc/xdg/autostart/plank-wrapper.desktop", "/etc/xdg/autostart/sodalite-plank-wrapper.desktop"],

  # /usr/bin
  ["../../lib/sodaliterocks.generate-oemconf/generate-oemconf.sh", "/usr/bin/generate-oemconf"],
  ["../sysroot/usr/bin/detach.sh", "/usr/bin/detach"],
  ["../sysroot/usr/bin/install-appcenter-flatpak.sh", "/usr/bin/sodalite-install-appcenter-flatpak"],
  ["../sysroot/usr/bin/install-epiphany.sh", "/usr/bin/sodalite-install-epiphany"],
  ["../sysroot/usr/bin/uninstall-gnome-apps.sh", "/usr/bin/sodalite-uninstall-gnome-apps"],

  # /usr/share/applications
  ["../sysroot/usr/share/applications/org.gnome.Software.desktop", "/usr/share/applications/org.gnome.Software.desktop"],

  # /usr/share/backgrounds
  ["../../lfs/wallpapers/adrien-olichon-gXqgs6Smvw-unsplash.jpg", "/usr/share/backgrounds/default/adrien-olichon-gXqgs6Smvw-unsplash.jpg"],
  ["../../lfs/wallpapers/austin-neill-AGPGx6Yr9NI-unsplash.jpg", "/usr/share/backgrounds/default/austin-neill-AGPGx6Yr9NI-unsplash.jpg"],
  ["../../lfs/wallpapers/cody-fitzgerald-iUBG6hQe4N0-unsplash.jpg", "/usr/share/backgrounds/default/cody-fitzgerald-iUBG6hQe4N0-unsplash.jpg"],
  ["../../lfs/wallpapers/dustin-humes-OrO_HSqlZMY-unsplash.jpg", "/usr/share/backgrounds/default/dustin-humes-OrO_HSqlZMY-unsplash.jpg"],
  ["../../lfs/wallpapers/jack-b-vcNPMwS08UI-unsplash.jpg", "/usr/share/backgrounds/default/jack-b-vcNPMwS08UI-unsplash.jpg"],
  ["../../lfs/wallpapers/karsten-wurth-7BjhtdogU3A-unsplash.jpg", "/usr/share/backgrounds/default/karsten-wurth-7BjhtdogU3A-unsplash.jpg"],
  ["../../lfs/wallpapers/max-okhrimenko-R-CoXmMrWFk-unsplash.jpg", "/usr/share/backgrounds/default/max-okhrimenko-R-CoXmMrWFk-unsplash.jpg"],
  ["../../lfs/wallpapers/nathan-dumlao-y_qtd7IizFE-unsplash.jpg", "/usr/share/backgrounds/default/nathan-dumlao-y_qtd7IizFE-unsplash.jpg"],
  ["../../lfs/wallpapers/ryan-stone-U3cctUBucn0-unsplash.jpg", "/usr/share/backgrounds/default/ryan-stone-U3cctUBucn0-unsplash.jpg"],
  ["../../lfs/wallpapers/smaran-alva-hno1wDtV1X4-unsplash.jpg", "/usr/share/backgrounds/default/smaran-alva-hno1wDtV1X4-unsplash.jpg"],
  ["../../lfs/wallpapers/william-daigneault-7c8z4KEvgds-unsplash.jpg", "/usr/share/backgrounds/default/william-daigneault-7c8z4KEvgds-unsplash.jpg"],
  ["../../lfs/wallpapers/zara-walker-_pC5hT6aXfs-unsplash.jpg", "/usr/share/backgrounds/default/zara-walker-_pC5hT6aXfs-unsplash.jpg"],

  # /usr/share/glib-2.0
  ["../sysroot/usr/share/glib-2.0/schemas/io.elementary.desktop.gschema.override", "/usr/share/glib-2.0/schemas/io.elementary.desktop.gschema.override"],

  # /usr/share/icons
  ["../../lfs/logo/logo.png", "/usr/share/icons/hicolor/256x256/apps/fedora-logo-icon.png"],
  ["../../lib/elementary.icons/apps/128/system-software-install.svg", "/usr/share/icons/elementary/128/system-software-install.svg"],
  ["../../lib/elementary.icons/apps/16/system-software-install.svg", "/usr/share/icons/elementary/16/system-software-install.svg"],
  ["../../lib/elementary.icons/apps/24/system-software-install.svg", "/usr/share/icons/elementary/24/system-software-install.svg"],
  ["../../lib/elementary.icons/apps/32/system-software-install.svg", "/usr/share/icons/elementary/32/system-software-install.svg"],
  ["../../lib/elementary.icons/apps/48/system-software-install.svg", "/usr/share/icons/elementary/48/system-software-install.svg"],
  ["../../lib/elementary.icons/apps/64/system-software-install.svg", "/usr/share/icons/elementary/64/system-software-install.svg"],
  ["../../lib/elementary.icons/apps/symbolic/system-software-install-symbolic.svg", "/usr/share/icons/elementary/symbolic/system-software-install-symbolic.svg"],
  ["../sysroot/usr/share/icons/default/index.theme", "/usr/share/icons/default/index.theme"]
]
remove-from-packages: [ # "Removing" files above in add-files
  ["evolution-data-server", "/etc/xdg/autostart/org.gnome.Evolution-alarm-notify.desktop"],
  ["fedora-workstation-backgrounds", "/usr/share/backgrounds/*"],
  ["gnome-session-wayland-session", "/usr/share/wayland-sessions/*"],
  ["gnome-session-xsession", "/usr/share/xsessions/*"],
  ["plank", "/etc/xdg/autostart/plank.desktop"]
]

# Options
boot-location: modules
check-groups:
  type: file
  filename: group
check-passwd:
  type: file
  filename: passwd
default_target: graphical.target
documentation: true
etc-group-members:
  - wheel
ignore-removed-users:
  - root
ignore-removed-groups:
  - root
postprocess-script: post.sh
selinux: true
tmp-is-dir: true
